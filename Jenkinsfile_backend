pipeline{
    agent any

    environment {
        DOTNET_ROOT = "/usr/local/share/dotnet/"
        PATH = "/usr/local/share/dotnet/:$PATH"
    }

    // options {
    //     skipDefaultCheckout(ture)
    // }

    triggers{
        pollSCM(" 5 * * * * ")
    }
    
    stages{
        stage("unitTest"){
            steps{
                // cleanWs()
                sh "git checkout BackEnd_Dev"
                sh "git branch --set-upstream-to-origin/BackEnd_Dev BackEnd_Dev"
                echo "====++++executing dotnet test ++++===="
                // dir('SomeWhereCinema.Backend/Test.Domain.Core/'){
                //     sh "dotnet test"
                // }
            }
        }
         stage("Build"){
            steps{
                echo "====++++executing dotnet build ++++===="
                // dir('SomeWhereCinema.Backend'){
                //     sh "dotnet build"
                // }
            }
            post{
                always{
                    echo "====++++ the first build stage ++++===="
                }
                success{
                    echo "=== Build are success"
                }
                failure{
                    echo "=== Build failure"
                }
        
            }
        }
        stage("merge branch"){
            steps{
                sh "git checkout BackEnd"
                sh "git branch --set-upstream-to-origin/BackEnd BackEnd"
                sh "git pull"
                sh "git merge BackEnd_Dev"
                sh "git remote -v"
                sh "git remote rm origin"
                sh "git remote add origin git@github.com:feix0033/EASV.CS21.SomeWhereCinema.4thSemester.DevOps_FullStack.ExamProject.git"
                sh "git remote -v"
                sh "git push -u origin BackEnd"
            }
        }
    }
}
